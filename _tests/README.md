# Compatibility Tests

This directory contains Docker-based compatibility tests that verify the `go-argonize` implementation against other language implementations:

- **Go vs PHP**: Verify Go-generated hashes using PHP's Argon2 verification API
- **Go vs Python**: Verify Go-generated hashes using Python's Argon2 verification API
- **Go vs C**: Compare hashes generated by Go and phc-winner-argon2 CLI

## Test Flow

1. Generate a password (random or deterministic for debugging)
2. Create an Argon2id encoded string using the Go `sample` binary
3. Verify the encoded string in the target language:
   - **PHP/Python**: Use the language's verification API to validate the Go-generated hash
   - **C**: Generate a hash with phc-winner-argon2 CLI and compare for equality

## Configuration

**Default Parameters** (RFC 9106 SECOND RECOMMENDED):

- Variant: Argon2id, Passes (t): 3, Memory (m): 65536 KiB (64 MiB), Parallelism (p): 4
- Salt length: 16 bytes, Tag length: 32 bytes

**Important Notes**:

- **phc-winner-argon2 CLI**: Uses `-m` as base-2 exponent (memory = 2^m KiB), so `-m 16` = 65536 KiB
- **Local builds**: Images build `sample` from local repository; rebuild if using outdated binary
- **Memory requirements**: C/Clang tests need ~64 MiB per hash
- **Test data**: Random by default; add deterministic cases for reproducible debugging

## Usage

Run from the repository root:

```bash
# build test images
docker compose build

# run PHP compatibility test
docker compose --file ./.github/docker-compose.yml run --rm --remove-orphans php

# run Python compatibility test
docker compose --file ./.github/docker-compose.yml run --rm --remove-orphans python

# run C/Clang compatibility test
docker compose --file ./.github/docker-compose.yml run --rm --remove-orphans clang
```

## Troubleshooting

**Rebuild images if needed:**

```bash
docker compose --file ./.github/docker-compose.yml build --no-cache
```

**Common Issues:**

- **Different parameter sets** (e.g. t=1,p=2 in PHP/Python): Rebuild images to ensure `sample` was built from local source
- **C test fails with "bad numeric input for -m"**: Confirm `-m 16` is used and container has sufficient memory
- **Memory errors in C/Clang tests**: Ensure host/container has enough RAM for 64 MiB memory requirement
